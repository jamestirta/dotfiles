#!/usr/bin/dash
[ -n "$2" ] && {
  imgdir=/tmp/resize4thumbnail/.img ; scaledir=/tmp/resize4thumbnail/.scale ; upndownscale(){ waifu2xauto "$( cat "$2" )" "$2" && resize720 "$( cat "$2" )"'-hd.png';} ; renameimg(){ mv "$( cat "$2" )"'-hd.png-resized.png' "$( cat "$2" )"'-resized.png';} ; success(){ echo "'$( cat "$2" )' has been upscaled $2x to '$( cat "$2")-resized.png'";}
  echo "$2" > $imgdir && resolution-for-script "$2" | frawk '{print int(720/$2 + 0.99)}' > $scaledir &&{
    [ 2 -gt "$( cat $scaledir )" ] && echo "'$2' need not be upscaled" && resize720 "$( cat "$imgdir" )" && exit 0;}||{
    [ 3 -gt "$( cat $scaledir )" ] && scale=2 && upndownscale $imgdir $scale && renameimg $imgdir && success $imgdir $scale && exit 0;}||{
    [ 5 -gt "$( cat $scaledir )" ] && scale=4 && upndownscale $imgdir $scale && renameimg $imgdir && success $imgdir $scale && exit 0;}||{
    [ 9 -gt "$( cat $scaledir )" ] && scale=8 && upndownscale $imgdir $scale && renameimg $imgdir && success $imgdir $scale && exit 0;}||{
    [ 17 -gt "$( cat $scaledir )" ] && scale=16 && upndownscale $imgdir $scale && renameimg $imgdir && success $imgdir $scale && exit 0;};}||{
echo "Usage: resize4thumbnail <image>";}
