#!/usr/bin/dash
if [ -n "$2" ]; then
  realesr(){ realesrgan-ncnn-vulkan -f png -i "$1" -o "$2" -s "$3" -n "$4" -x -v;}
  upscaler=realesrgan-x4plus-anime
  if [ "$2" -le 4 ]; then
    scale=4
  elif [ "$2" -le 16 ]; then
    scale=16
    it=0
  else
    scale=64
    it=1
  fi
  out=$( cleanpng "$1" )'-hd.png'
  realesr "$1" "$out" "$scale" "$upscaler"

  if [ -n "$it" ]; then
    for i in $( seq 1 "$it" ); do
      realesr "$out" "$out" "$scale" "$upscaler"
    done
  fi
else
  echo "Usage: waifu2xauto <image> <scale>"
fi
