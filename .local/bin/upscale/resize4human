#!/usr/bin/dash
[ -n "$2" ] && {
  imgdir=/tmp/res4thumbnail/.img
  scaledir=/tmp/res4thumbnail/.scale
  upndownscale(){ waifu2xauto "$( cat "$2" )" "$2"
  res720 "$( cat "$2" )";}
  success(){ echo "'$( cat "$2" )' has been upscaled $2x.";}
  echo "$2" > $imgdir && getres "$2" | frawk '{print int(720/$2 + 0.99)}' > $scaledir &&{
    [ 2 -gt "$( cat $scaledir )" ] && echo "'$2' need not be upscaled" && res720 "$( cat "$imgdir" )" && exit 0;}||{
    [ 3 -gt "$( cat $scaledir )" ] && scale=2 && upndownscale $imgdir $scale && success $imgdir $scale && exit 0;}||{
    [ 5 -gt "$( cat $scaledir )" ] && scale=4 && upndownscale $imgdir $scale && success $imgdir $scale && exit 0;}||{
    [ 9 -gt "$( cat $scaledir )" ] && scale=8 && upndownscale $imgdir $scale && success $imgdir $scale && exit 0;}||{
    [ 17 -gt "$( cat $scaledir )" ] && scale=16 && upndownscale $imgdir $scale && success $imgdir $scale && exit 0;};}||{
echo "Usage: res4thumbnail <image>";}
