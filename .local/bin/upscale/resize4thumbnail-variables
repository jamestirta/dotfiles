#!/usr/bin/dash
[ -n "$1" ] &&{
  img=$1 ; res=$( getres "$img" ) ; upndownscale(){ waifu2xauto "$1" "$2" && resize720 "$1"'-hd.png';} ; success(){ echo "'$1' has been upscaled $2x.";} ; echo | frawk '{print int(720/'$res' + 0.99)}' > /tmp/resize4thumbnail/.scale ; scale=$( cat /tmp/resize4thumbnail/.scale ) ; {
    [ 2 -gt "$scale" ] && echo "$img need not be upscaled" && resize720 "$img" && exit 0;}||{
    [ 3 -gt "$scale" ] && upscale=2 && upndownscale "$img" $upscale && success "$img" $upscale && exit 0;}||{
    [ 5 -gt "$scale" ] && upscale=4 && upndownscale "$img" $upscale && success "$img" $upscale && exit 0;}||{
    [ 9 -gt "$scale" ] && upscale=8 && upndownscale "$img" $upscale && success "$img" $upscale && exit 0;}||{
    [ 17 -gt "$scale" ] && upscale=16 && upndownscale "$img" $upscale && success "$img" $upscale && exit 0;};}||{
echo "Usage: resize4thumbnail <image>";}
